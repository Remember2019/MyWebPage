/*const data = {
    "messages":[],
    "stream":false,
    "model":"gpt-3.5-turbo-16k",
    "temperature":0.5,
    "presence_penalty":0,
    "frequency_penalty":0,
    "top_p":1
}*/
const data = {
    "model":"gpt-4",
    "stream":false,
    "frequency_penalty":0,
    "presence_penalty":0,
    "temperature":0.6,
    "top_p":1,
    "messages":[],
}

const book_detail = {
    "1": "本书是一部奇幻之作，承载着敦煌文献神秘精髓。读者将在这个奇妙的世界中与千年的历史相交融，共同探寻藏匿在莫高窟深处的珍贵文献，揭开古老中国文明的神秘面纱。\n在《敦煌遗书》中，我们将发现敦煌文献的多彩之美。从佛经的庄严至文学作品的瑰丽，每一页都是时光的见证者，记录了古代智者们对宗教、艺术和哲学的深刻思考。本书不仅提供了文献的原文，更配有专家学者的深度解读，带领读者深入了解每段文字背后的历史脉络、文化内涵和独特智慧。\n《敦煌遗书》并非只是一本静态的书籍，更是一个与读者互动的空间。丰富多彩的学习资源，包括音频解读和互动问答，将帮助读者更全面地理解敦煌文献的奥秘。这是一场时光之旅，将您带入一个充满智慧与艺术的历史之旅。",
    "2": "《敦煌艺术大辞典》是一部深度探讨敦煌艺术的权威著作，为读者呈现了一个全面而系统的敦煌艺术世界。这本辞典提供了深刻的洞察力，囊括了敦煌石窟中的千余年艺术传承。\n在这部著作中，读者将发现对敦煌艺术的多层次解读，涵盖了壁画、雕塑、书法等多个艺术形式。作者从历史、文化、宗教等多个角度出发，深入剖析每一件作品背后的文化内涵，使读者更好地理解敦煌艺术的独特之处。\n这本辞典以其丰富的图文资料而脱颖而出，为读者提供了大量石窟艺术的视觉盛宴。透过这些艺术品的展示，读者能够感受到敦煌艺术的独特魅力，同时对中国古代文明的演变有更深刻的认识。\n不仅如此，《敦煌艺术大辞典》为读者提供了一次深度的学术之旅，让艺术爱好者、研究者以及普通读者都能在其中汲取丰富的知识，沉浸于敦煌石窟的历史与艺术的交织之中。",
    "3": "《莫高窟史话》是一部深刻而生动地述说着敦煌莫高窟历史的著作，为读者打开了这个古老艺术宝库的奇妙之门。这本书深入挖掘了莫高窟的发现、发展和演变，以及石窟中所蕴含的历史、文化和宗教内涵。\n在《莫高窟史话》中，作者以生动的笔触勾勒出莫高窟的建筑风格、艺术特色以及文化渊源。通过对莫高窟历史的讲述，读者能够追溯到这片土地上千年来的变迁，感受到石窟壁画和雕塑作品所传递的独特魅力。\n本书通过对莫高窟的艺术品进行深度解读，揭示了其中蕴含的宗教信仰、历史故事和文学意蕴，将读者带入这个古老石窟的精神世界，体验那些千年岁月所沉淀的智慧和艺术灵感。",
    "4": "《敦煌写本宅经葬书校注》是一部深入研究敦煌写本、宅经和葬书的校注著作。通过深刻的校勘和注释，该书为读者提供了对特定敦煌文献的全面理解。书中包含对宅经和葬书的详细解读，涉及古代宗教、文学和历史等多个方面。\n作者致力于还原敦煌写本的原貌，通过对古文献的考辨和注释，帮助读者更好地理解其中蕴含的文化内涵和历史背景。这样的校注工作有助于解开敦煌文献的奥秘，使得这些古老的经典在当代焕发新的生命力。\n《敦煌写本宅经葬书校注》旨在为研究者、学者以及对敦煌文献感兴趣的读者提供一份丰富而可靠的资料，为深入探讨古代文献贡献一份重要的参考。通过对写本的详尽解读，这本书成为深化对敦煌文献研究的重要工具。该书深入研究了敦煌文献的演变过程，将读者引领进入一个遗存千年的文学和艺术宝库。通过对宅经和葬书的细致解读，读者能够感受到这些古老文献所传递的智慧和情感，了解它们在中国文化传统中的独特地位。这部著作不仅是一本关于敦煌的校注书籍，更是一次深度探索中国古代文献的精彩之旅。",
    "5": "《敦煌旧事》是一部深度挖掘敦煌历史与文化的力作，为读者呈现了这片千年古老沙漠中的瑰丽传承。该书透过历史的长河，将我们带入了敦煌莫高窟的独特世界，揭开了莫高窟这一文化宝库的神秘面纱。\n在这本著作中，作者通过对敦煌历史的考证，呈现了敦煌从鼎盛时期到现代的变迁。这包括了对莫高窟的发现、保护和研究历程的深入探讨，使读者能够更加全面地了解这个世界文化遗产的价值和意义。\n敦煌，作为一个重要的文化交汇点，在这本书中被描绘成一个充满异域风情、蕴藏着佛教文化精髓的地方。这里的每一块石头，每一幅壁画，都是古代智者们对宗教、哲学和艺术的深刻思考的见证。\n书中融入了大量关于莫高窟艺术的图文资料，通过这些视觉呈现，读者能够近距离欣赏莫高窟石窟的艺术之美。这些图片将带领读者漫步在历经沧桑的石窟间，感受那些古老壁画所述说的故事，窥见千年文明的辉煌。同时，《敦煌旧事》从文献学、考古学和艺术史的角度，对莫高窟中的各类文献进行了详实的解读。这不仅包括佛教经典，还有与宗教、历史、文学等多个领域相关的文献，使读者更好地理解这片文化瑰宝的深厚内涵。书中还探讨了敦煌文化的传承和发展，揭示了莫高窟作为一个文化瑰宝的历史轨迹。在这里，读者可以领略到敦煌文化如何在历史的长河中承传千年，对中国文明的独特贡献。",
    "6": "《敦煌本记》是一部深度挖掘敦煌文献的瑰宝，它透过古老的写本，向读者展示了这座千年之城的独特文化和历史积淀。这本书成为解锁敦煌文献奥秘的一把钥匙，通过对古代手稿的研究，向我们呈现了这片沙漠之中古老文明的绚烂画卷。\n《敦煌本记》以其对敦煌文献的全面解读而脱颖而出。书中涉及了丰富的内容，包括文学、历史、宗教等多个领域。这本书深入剖析了每一篇记载，还原了当时社会、文化和人们生活的真实面貌，使我们能够穿越时光，亲历古代敦煌的点滴，突显了敦煌文献在古代文明中的重要地位。通过对这些文献的系统整理和研究，读者或能够深刻领略到敦煌作为丝绸之路重镇所承载的文化多元性和交流的历史价值。这本书揭示了敦煌在中古时期是一个文化交汇的独特场所，不仅仅是商贸的集散地，更是知识的交流中心。\n在书中，我们能够看到关于宗教仪式、政治事件、农业生产等多个方面的细致描绘，这让我们对古代敦煌社会的面貌有了更为全面的了解，此外本书还为读者提供了一场时光之旅。通过书中的插图、图片，我们或能够近距离欣赏敦煌文献的艺术之美。这些古老的手稿不仅仅是文字的载体，更是艺术的表达，通过插图和装饰，使得书籍更加生动有趣。\n这本书通过对文献的详细解读，使得普通读者也能够沉浸其中，领略到敦煌文献所蕴含的深邃智慧。它为文献学、历史学、艺术学等多个领域的学者提供了丰富的研究素材，成为深入探讨古代敦煌文明的参考之作。"
}

const book_name = {
    "1": "《敦煌遗书》",
    "2": "《敦煌艺术大辞典》",
    "3": "《莫高窟史话》",
    "4": "《敦煌写本宅经葬书校注》",
    "5": "《敦煌旧事》",
    "6": "《敦煌本记》"
}

const book_path = {
    "1": "drawable/book-pics/2.png",
    "2": "drawable/book-pics/3.png",
    "3": "drawable/book-pics/4.png",
    "4": "drawable/book-pics/5.png",
    "5": "drawable/book-pics/6.png",
    "6": "drawable/book-pics/7.png"
}

function getRes() {
    fetch('http://localhost:8080/api?userXq=千佛山校区&userFj=502043&payType=2')
        .then(res => res.json())
        .then(result => console.log(result))
}

function showLanguageMenu() {
    alert('选择语言');
}

function showSidebar() {
    document.getElementById('sidebar').className += ' show-menu'
}

function hideSidebar() {
    document.getElementById('sidebar').className = 'menu-nav'
}

function sendPostRequest(data, callback) {
    fetch("https://ib-private-git-allstarproductions-gpt-50365e-allstarproductions.vercel.app/api/openai/v1/chat/completions", {
        /*"https://chat6.dingsm.top/api/openai/v1/chat/completions"*/
        method: "POST",
        headers: {
            /*"Authorization": "Bearer nk-ABC123456",
            "X-Openai-End-Point": "https://api.chatnio.net/v1",
            "X-Openai-Api-Key": "sk-af53adfeee6ebf5ce10a5902c8216d6d79e3ce727dac4f5b9ec6fc0d20c20af4",
            "Cookie": "LOBE_LOCALE=zh-CN; LOBE_THEME_PRIMARY_COLOR=undefined; LOBE_THEME_NEUTRAL_COLOR=undefined",*/
            "User-Agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36"
        },
        body: JSON.stringify(data)
    })
        .then(function (response) {
            if (response.ok) {
                return response.json();
            }
            throw new Error("HTTP error " + response.status);
        })
        .then(function (responseData) {
            callback(responseData);
        })
        .catch(function (error) {
            console.log(error);
            errorTip('请检查网络连接')
        });
}

function submit(){
    const inputElement = document.getElementById("myInput");
    const inputValue = inputElement.value;
    const chatDisplay = document.querySelector('.chat-display');
    const newMessage = document.createElement('div');
    const content = document.createElement('div');

    if (data.messages.length >= 40) {
        alert('开发者要求不得超过20条问题，现在已经清除对话，请重新开始！');
        console.log('开发者要求不得超过20条问题，现在已经清除对话，请重新开始！')
        inputElement.value = '';
        data.messages.splice(0,data.messages.length);
        chatDisplay.innerHTML = '';
        return;
    }
    newMessage.classList.add('new_message');
    newMessage.style.alignSelf = 'flex-end';
    content.classList.add('content');
    content.classList.add('right-chat');
    content.innerHTML = inputValue;
    chatDisplay.appendChild(newMessage);
    newMessage.appendChild(content);
    data.messages.push({"role":"user","content":inputValue})

    function handleResponse(response) {
        const responseText = response.choices[0].message.content; // 将响应转换为字符串
        const replyMessage = document.createElement('div');
        const replyContent = document.createElement('div');
        replyMessage.classList.add('new_message');
        replyContent.classList.add('content');
        replyContent.classList.add('left-chat');
        replyContent.innerHTML = responseText;
        chatDisplay.appendChild(replyMessage);
        replyMessage.appendChild(replyContent);
        data.messages.push({"role":"assistant","content":responseText})
        console.log(responseText);
        // 在这里处理响应数据
    }
    sendPostRequest(data, handleResponse);
    inputElement.value = '';
}

function showBookDetail(n) {
    const detail = book_detail[n];
    const title = book_name[n];
    const path = book_path[n];
    drawer.value = true;
    this_title.value = title;
    this_detail.value = detail;
    this_path.value = path;
}

let darkModeMediaQuery = window.matchMedia('(prefers-color-scheme: dark)');
let handleDarkModeChange = (e) => {
    if (e.matches) {
        // 系统处于暗黑模式，给 html 添加 "dark" 类
        document.documentElement.classList.add('dark');
    } else {
        // 系统不处于暗黑模式，移除 html 的 "dark" 类
        document.documentElement.classList.remove('dark');
    }
};
darkModeMediaQuery.addListener(handleDarkModeChange);
handleDarkModeChange(darkModeMediaQuery);